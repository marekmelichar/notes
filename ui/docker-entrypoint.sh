#!/bin/sh

# Generate env.js from environment variables
# Note: Using ${VAR-default} (not :-) so empty string is preserved, not replaced by default
cat > /usr/share/nginx/html/env.js << EOF
// Runtime environment configuration (generated by Docker)
window.API_URL = '${API_URL-}';
window.KEYCLOAK_URL = '${KEYCLOAK_URL:-http://localhost:8080}';
window.KEYCLOAK_REALM = '${KEYCLOAK_REALM:-epoznamky}';
window.KEYCLOAK_CLIENT_ID = '${KEYCLOAK_CLIENT_ID:-epoznamky-frontend}';
window.MOCK_MODE = ${MOCK_MODE:-false};
EOF

echo "Generated env.js with:"
echo "  API_URL: ${API_URL-}"
echo "  KEYCLOAK_URL: ${KEYCLOAK_URL:-http://localhost:8080}"
echo "  KEYCLOAK_REALM: ${KEYCLOAK_REALM:-epoznamky}"
echo "  KEYCLOAK_CLIENT_ID: ${KEYCLOAK_CLIENT_ID:-epoznamky-frontend}"

# Execute the main command
exec "$@"
